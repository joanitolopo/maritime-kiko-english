{% extends 'base.html' %}
{% block title %}Unit {{ unit_id }} - {{ section_content.title or 'Guided Practice: Communication Tasks' }}{% endblock %}

{% block page_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/guided_intro.css') }}">
{% endblock %}

{% block content %}
<main class="container my-4 guided-intro-container" aria-live="polite">
  <div class="guided-scene shadow-lg" role="region" aria-label="Guided Practice Introduction">

    <!-- Captain Ray Avatar -->
    <div class="avatar-area">
      <img src="{{ url_for('static', filename=section_content.avatar or 'img/captain_ray_radio.png') }}" 
           alt="Captain Ray" class="avatar-ray">
    </div>

    <!-- Background radio console (decorative) -->
    <div class="radio-console" id="radio-console" aria-hidden="true"></div>

    <!-- Instructional Box -->
    <div class="guided-box">
      <div class="top-row">
        <div class="title small">Guided Practice: Communication Tasks</div>
        <div class="lang-toggle">
          <button id="lang-toggle" class="toggle-pill" aria-pressed="false">EN</button>
        </div>
      </div>

      <div class="guided-text">
        <p id="guided-paragraph">
          {{ section_content.text_en or "Now, let’s try real communication. I’ll guide you through short radio tasks. Listen first, then repeat or respond as instructed." }}
        </p>
      </div>

      <!-- Audio control -->
      <div class="audio-control">
        <button id="audio-btn" class="audio-play-btn" aria-label="Play intro audio">
          <i class="fas fa-play" aria-hidden="true"></i>
        </button>
      </div>

      <!-- Footer CTA -->
      <div class="footer-cta">
        <button id="start-guided" class="btn btn-start" type="button"
                data-next="{{ url_for('learning.learning_unit', unit_id=unit_id, section=section_content.start_next_section or 'guided_task_1') }}">
          Start Task 1 <i class="fas fa-arrow-right ms-2"></i>
        </button>
      </div>
    </div>

  </div>

  <!-- Hidden audio -->
  <audio id="guided-audio" preload="auto" 
         src="{{ section_content.audio_en or '/static/data/audio/unit_1/guided_intro_en.wav' }}"></audio>
</main>
{% endblock %}

{% block page_js %}
<script>
  window.UNIT_CONTENT = {{ content|tojson|safe }};
  window.SECTION_CONTENT = {{ section_content|tojson|safe }};
  window.UNIT_ID = {{ unit_id }};
</script>
<script src="{{ url_for('static', filename='js/guided_intro.js') }}" defer></script>
{% endblock %}
