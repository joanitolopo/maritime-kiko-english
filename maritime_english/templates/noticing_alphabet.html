{% extends 'base.html' %}
{% block title %}Unit {{ unit_id }} - Radio Spelling Practice{% endblock %}

{% block page_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/input_vhf.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/noticing_alphabet.css') }}">
{% endblock %}

{% block content %}
<!-- HEADER -->
<header class="top-bar">
    <div class="container d-flex justify-content-end align-items-center header-right-group">
        <a href="{{ url_for('learning.learning_unit', unit_id=unit_id, section='noticing_numbers') }}" class="btn-learn-nav btn-back" aria-label="Back to Noticing Intro">
            <i class="fas fa-chevron-left me-1"></i>
            <span class="btn-text">Back</span>
        </a>
        
        <div class="current-unit-title d-flex align-items-center ms-3 me-3">
            <i class="fas fa-anchor me-2"></i>
            <span>Unit {{ unit_id }} - {{ unit_data.title }}</span>
        </div>

        <a href="{{ url_for('main.home') }}" class="btn-learn-nav btn-home" aria-label="Home">
            <i class="fas fa-home"></i>
        </a>
    </div>
</header>

<!-- MAIN CONTENT -->
<div class="main-content">
    
    <!-- LEFT SIDEBAR -->
    <aside class="drill-sidebar">
        
        <div class="activity-badge">
            <div class="badge-icon">
                <i class="fa-solid fa-anchor"></i>
            </div>
            <div class="badge-text">
                <h4>F. Practice with the Crew</h4>
            </div>
        </div>

        <!-- Captain Section with Radio Waves -->
        <div class="captain-instruction-card">
            <div class="captain-avatar-wrapper">
                <img src="{{ url_for('static', filename='img/Captain male-3-left.png') }}" alt="Captain Character" class="captain-avatar">
                <div class="radio-waves">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
            
            <!-- Speech Bubble -->
            <div class="instruction-bubble">
                <p class="speech-text-drill">
                    Alright, cadets! This time you will practice real radio exchanges, sending and receiving messages just like on board! Listen carefully and follow each step with confidence.
                </p>
                
                <div class="drill-controls">
                    <button class="control-btn audio-btn" id="captain-audio-btn">
                        <i class="fa-solid fa-play"></i>
                    </button>
                    <button class="control-btn translate-btn" id="translate-btn">
                        <i class="fa-solid fa-language"></i>
                        <span>Translate</span>
                    </button>
                </div>
            </div>
        </div>
        
    </aside>

    <!-- RIGHT CONTENT -->
    <main class="vhf-main">
        
        <!-- ACTIVITY: Radio Exchange Practice -->
        <section class="activity-card vhf-activity">
            <div class="activity-header">
                <div class="header-left">
                    <i class="fas fa-comments activity-number"></i>
                    <div class="header-text">
                        <h3>Activity 7: Radio Exchange Practice!</h3>
                        <p>Practice radio exchanges between vessels</p>
                    </div>
                </div>
                <div class="channel-indicator">
                    <i class="fas fa-wifi"></i>
                    <span>Channel 16</span>
                </div>
            </div>

            <div class="activity-body">
                
                <!-- Instruction Banner (Global) -->
                <div class="instruction-banner">
                    <div class="banner-icon">
                        <i class="fas fa-headphones"></i>
                    </div>
                    <div class="banner-text">
                        <p class="instruction-text-vhf">Listen to the radio exchange between two vessels. Notice how each vessel identifies itself and responds. Then practice your role!</p>
                    </div>
                </div>

                <!-- EXAMPLE: HORIZON → ANTARES -->
                <div class="activity-part">
                    <h4 class="part-title">
                        <span class="part-number">Example</span>
                        Radio Exchange: HORIZON calls ANTARES
                    </h4>
                    
                    <div class="exchange-row">
                        
                        <!-- Caller Card (Play) -->
                        <div class="vessel-exchange-card caller-card" data-example="example" data-role="caller" data-action="play">
                            <div class="card-overlay">
                                <span class="role-badge caller-badge">
                                    <i class="fas fa-phone"></i> The Caller
                                </span>
                            </div>
                            <img src="{{ url_for('static', filename='img/operator_vessel_horizon.png') }}" alt="HORIZON Operator" class="vessel-bg-img">
                            <div class="card-footer">
                                <div class="vessel-name-display">HORIZON</div>
                                <button class="play-exchange-btn">
                                    <i class="fas fa-play"></i>
                                    <span>Play Message</span>
                                </button>
                            </div>
                        </div>

                        <!-- Arrow -->
                        <div class="exchange-arrow-icon">
                            <i class="fas fa-arrow-right"></i>
                        </div>

                        <!-- Receiver Card (Play) -->
                        <div class="vessel-exchange-card receiver-card" data-example="example" data-role="receiver" data-action="play">
                            <div class="card-overlay">
                                <span class="role-badge receiver-badge">
                                    <i class="fas fa-phone-volume"></i> The Receiver
                                </span>
                            </div>
                            <img src="{{ url_for('static', filename='img/operator_vessel_antara.png') }}" alt="ANTARES Operator" class="vessel-bg-img">
                            <div class="card-footer">
                                <div class="vessel-name-display">ANTARES</div>
                                <button class="play-exchange-btn">
                                    <i class="fas fa-play"></i>
                                    <span>Play Message</span>
                                </button>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Divider -->
                <div class="part-divider"></div>
                
                <div class="roleplay-header">
                    <div class="roleplay-header-main">
                        <i class="fa-solid fa-hand-point-right"></i>
                        <h3 class="roleplay-title-text">Your Turn - Speak Clearly</h3>
                    </div>
                    <p class="roleplay-subtitle">Practice as the Caller or Receiver. Listen to examples, then record your message!</p>
                </div>  

                <!-- PART 1: ADOUR → APOLLON (You are CALLER - Record) -->
                <div class="activity-part">
                    <h4 class="part-title">
                        <span class="part-number">Part 1</span>
                        Your Turn: ADOUR calls APOLLON
                    </h4>
                    
                    <div class="exchange-row">
                        
                        <!-- Caller Card (Record - YOU) -->
                        <div class="vessel-exchange-card caller-card user-card" data-example="part1" data-role="caller" data-action="record">
                            <div class="card-overlay">
                                <span class="role-badge caller-badge user-badge">
                                    <i class="fas fa-user"></i> You are Caller
                                </span>
                            </div>
                            {% if user_info and user_info.gender == 'Female' %}
                                <img src="{{ url_for('static', filename='img/Cadet female-4.png') }}" 
                                    alt="Your Profile" 
                                    class="vessel-bg-img">
                            {% else %}
                                <img src="{{ url_for('static', filename='img/Cadet male-6.png') }}" 
                                    alt="Your Profile" 
                                    class="vessel-bg-img">
                            {% endif %}
                            <div class="card-footer">
                                <div class="vessel-name-display">ADOUR</div>
                                <button class="record-exchange-btn">
                                    <i class="fas fa-microphone"></i>
                                    <span>Record Message</span>
                                </button>
                            </div>
                        </div>

                        <!-- Arrow -->
                        <div class="exchange-arrow-icon">
                            <i class="fas fa-arrow-right"></i>
                        </div>

                        <!-- Receiver Card (Play) -->
                        <div class="vessel-exchange-card receiver-card" data-example="part1" data-role="receiver" data-action="play">
                            <div class="card-overlay">
                                <span class="role-badge receiver-badge">
                                    <i class="fas fa-phone-volume"></i> The Receiver
                                </span>
                            </div>
                            <img src="{{ url_for('static', filename='img/operator_vessel_apollon.png') }}" alt="APOLLON Operator" class="vessel-bg-img">
                            <div class="card-footer">
                                <div class="vessel-name-display">APOLLON</div>
                                <button class="play-exchange-btn">
                                    <i class="fas fa-play"></i>
                                    <span>Play Message</span>
                                </button>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Divider -->
                <div class="part-divider"></div>

                <!-- PART 2: BAYSTAR → SUNSHINE (You are RECEIVER - Record) -->
                <div class="activity-part">
                    <h4 class="part-title">
                        <span class="part-number">Part 2</span>
                        Your Turn: BAYSTAR calls SUNSHINE
                    </h4>
                    
                    <div class="exchange-row">
                        
                        <!-- Caller Card (Play) -->
                        <div class="vessel-exchange-card caller-card" data-example="part2" data-role="caller" data-action="play">
                            <div class="card-overlay">
                                <span class="role-badge caller-badge">
                                    <i class="fas fa-phone"></i> The Caller
                                </span>
                            </div>
                            <img src="{{ url_for('static', filename='img/operator_vessel_baystar.png') }}" alt="BAYSTAR Operator" class="vessel-bg-img">
                            <div class="card-footer">
                                <div class="vessel-name-display">BAYSTAR</div>
                                <button class="play-exchange-btn">
                                    <i class="fas fa-play"></i>
                                    <span>Play Message</span>
                                </button>
                            </div>
                        </div>

                        <!-- Arrow -->
                        <div class="exchange-arrow-icon">
                            <i class="fas fa-arrow-right"></i>
                        </div>

                        <!-- Receiver Card (Record - YOU) -->
                        <div class="vessel-exchange-card receiver-card user-card" data-example="part2" data-role="receiver" data-action="record">
                            <div class="card-overlay">
                                <span class="role-badge receiver-badge user-badge">
                                    <i class="fas fa-user"></i> You are Receiver
                                </span>
                            </div>
                            {% if user_info and user_info.gender == 'Female' %}
                                <img src="{{ url_for('static', filename='img/Cadet female-4.png') }}" 
                                    alt="Your Profile" 
                                    class="vessel-bg-img">
                            {% else %}
                                <img src="{{ url_for('static', filename='img/Cadet male-6.png') }}" 
                                    alt="Your Profile" 
                                    class="vessel-bg-img">
                            {% endif %}
                            <div class="card-footer">
                                <div class="vessel-name-display">SUNSHINE</div>
                                <button class="record-exchange-btn">
                                    <i class="fas fa-microphone"></i>
                                    <span>Record Message</span>
                                </button>
                            </div>
                        </div>

                    </div>
                </div>

            </div>
        </section>

    </main>

    <!-- POPUP MODAL -->
    <div class="exchange-modal" id="exchangeModal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <button class="modal-close-btn" id="closeModal">
                <i class="fas fa-times"></i>
            </button>
            
            <div class="modal-header">
                <div class="modal-icon">
                    <i class="fas fa-broadcast-tower"></i>
                </div>
                <h3 id="modalTitle">Radio Communication</h3>
            </div>

            <div class="modal-body">
                <!-- Vessel Information -->
                <div class="vessel-info-row">
                    <div class="info-col">
                        <label><i class="fas fa-ship"></i> Vessel Name</label>
                        <value id="modalVesselName">-</value>
                    </div>
                    <div class="info-col">
                        <label><i class="fas fa-hashtag"></i> MMSI</label>
                        <value id="modalMMSI">-</value>
                    </div>
                    <div class="info-col">
                        <label><i class="fas fa-broadcast-tower"></i> Call Sign</label>
                        <value id="modalCallSign">-</value>
                    </div>
                    <div class="info-col">
                        <label><i class="fas fa-broadcast-tower"></i> Call Sign Receiver</label>
                        <value id="modalCallSignReceiver">-</value>
                    </div>
                </div>

                <!-- Action Button Container (akan diisi dinamis) -->
                <div id="modalActionContainer"></div>
            </div>
        </div>
    </div>

</div>

<!-- Continue Button (Hidden by default) -->
<div class="continue-wrapper" id="continueWrapper" style="display: none;">
    <a href="{{ url_for('learning.complete_subunit', unit_id=unit_id, subunit_index=6) }}" class="continue-button">
        <span>Continue Sailing</span>
    </a>
</div>

<!-- <div class="continue-wrapper" id="continueWrapper" style="display: none;">
    <a href="{{ url_for('main.home') }}" class="continue-button">
        <span>Continue Sailing</span>
    </a>
</div> -->

{% endblock %}

{% block page_js %}
<script>
    window.UNIT_CONTENT = {{ (content or {})|tojson|safe }};
    window.SECTION_CONTENT = {{ (section_content or {})|tojson|safe }};
    window.UNIT_ID = {{ unit_id | default(0) }};
</script>
<script src="{{ url_for('static', filename='js/noticing_alphabet.js') }}"></script>
{% endblock %}