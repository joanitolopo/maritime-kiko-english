{% extends 'base.html' %}
{% block title %}Unit {{ unit_id }} - {{ section_content.title or 'Noticing: Pronunciation' }}{% endblock %}

{% block page_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/noticing_intro.css') }}">
{% endblock %}

{% block content %}
<header class="top-bar">
    <div class="container d-flex justify-content-end align-items: center header-right-group">
        <a href="{{ url_for('learning.learning_unit', unit_id=unit_id, section='input_vhf') }}" class="btn-learn-nav btn-back" aria-label="Back to courses">
            <i class="fas fa-chevron-left me-1" aria-hidden="true"></i>
            <span class="btn-text">Back</span>
        </a>
        
        <div class="current-unit-title d-flex align-items-center ms-3 me-3" aria-hidden="false">
            <i class="fas fa-anchor me-2" aria-hidden="true"></i>
            <span>Unit {{ unit_id }} - {{ unit_data.title }}</span>
        </div>

        <a href="{{ url_for('main.home') }}" class="btn-learn-nav btn-home" aria-label="Home">
            <i class="fas fa-home" aria-hidden="true"></i>
        </a>
    </div>
</header>

<div class="vhf-container">
    
    <aside class="vhf-sidebar">
        
        <div class="activity-badge">
            <div class="badge-icon">
                <i class="fa-solid fa-anchor"></i>
            </div>
            <div class="badge-text">
                <h4>D. Navigate the Language</h4>
            </div>
        </div>

        <div class="captain-instruction-card">
            <div class="captain-avatar-wrapper">
                <img src="{{ url_for('static', filename='img/Captain male-3.png') }}" alt="Captain" class="captain-avatar">
                <div class="radio-waves">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>

            <div class="instruction-bubble">
                <p class="speech-text-noticing">
                    Cadet, this time we'll study how radio messages are built! Every call at sea follows a clear order, opening, middle, and closing. Let's read both sides and see how real sailors do it.
                </p>
                <div class="vhf-controls noticing-controls">
                    <button class="control-btn audio-btn">
                        <i class="fa-solid fa-play"></i>
                    </button>
                    <button class="control-btn translate-btn">
                        <i class="fa-solid fa-language"></i>
                        <span>Translate</span>
                    </button>
                </div>
            </div>
        </div>
        
    </aside>

    <main class="vhf-main">
        
        <section class="exchange-card">
            <div class="exchange-header">
                <div class="header-left">
                    <div class="header-icon">
                        <i class="fa-solid fa-book-open"></i>
                    </div>
                    <div class="header-text">
                        <h3>Activity 5. Decode the Message!</h3>
                        <p>Understand the components of radio exchange</p>
                    </div>
                </div>
            </div>

            <div class="exchange-body">
                <div class="instruction-banner">
                    <div class="banner-icon">
                        <i class="fa-solid fa-book"></i>
                    </div>
                    <p class="instruction-text-noticing">
                        Read both messages carefully. Notice the structure of each radio exchange. Click Learn More to see the Captain's notes.
                    </p>
                </div>

                <div class="conversation-timeline">
                    
                    <!-- CALLER MESSAGE - NEW STRUCTURED FORMAT -->
                    <div class="message-wrapper caller-message">
                        <div class="message-card-structured">
                            <div class="message-header-structured caller-header">
                                <div class="vessel-avatar-small">
                                    <img src="{{ url_for('static', filename='img/operator_vessel_horizon.png') }}" alt="Caller">
                                </div>
                                <h4 class="message-title">Caller's Message</h4>
                            </div>
                            <div class="message-body-structured">
                                <div class="structure-row">
                                    <div class="structure-number">1.</div>
                                    <div class="structure-label">Opening</div>
                                    <div class="structure-content">
                                        This is Motor Vessel Horizon,<br>
                                        Call Sign Yankee Bravo Oscar November Niner.<br>
                                        MMSI too-fower-ait-wun-zeero-fife-niner-zeero-zeero.
                                    </div>
                                </div>
                                <div class="structure-row">
                                    <div class="structure-number">2.</div>
                                    <div class="structure-label">Middle</div>
                                    <div class="structure-content">
                                        Calling Motor Vessel Antares.<br>
                                        Call Sign Lima Alfa Papa Whisky Fife.
                                    </div>
                                </div>
                                <div class="structure-row">
                                    <div class="structure-number">3.</div>
                                    <div class="structure-label">Closing</div>
                                    <div class="structure-content">
                                        Channel wun six. Over."
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="conversation-arrow">
                        <div class="arrow-line"></div>
                        <div class="arrow-icon">
                            <i class="fas fa-exchange-alt"></i>
                        </div>
                        <div class="arrow-label">Exchange</div>
                    </div>

                    <!-- RECEIVER MESSAGE - NEW STRUCTURED FORMAT -->
                    <div class="message-wrapper receiver-message">
                        <div class="message-card-structured">
                            <div class="message-header-structured receiver-header">
                                <div class="vessel-avatar-small">
                                    <img src="{{ url_for('static', filename='img/operator_vessel_antara.png') }}" alt="Receiver">
                                </div>
                                <h4 class="message-title">Receiver's Message</h4>
                            </div>
                            <div class="message-body-structured">
                                <div class="structure-row">
                                    <div class="structure-number">1.</div>
                                    <div class="structure-label">Opening</div>
                                    <div class="structure-content">
                                        "Motor Vessel Horizon, this is Antares.
                                    </div>
                                </div>
                                <div class="structure-row">
                                    <div class="structure-number">2.</div>
                                    <div class="structure-label">Middle</div>
                                    <div class="structure-content">
                                        Receiving you loud and clear.
                                    </div>
                                </div>
                                <div class="structure-row">
                                    <div class="structure-number">3.</div>
                                    <div class="structure-label">Closing</div>
                                    <div class="structure-content">
                                        Over."
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <div class="learn-more-section">
                    <button class="learn-more-button" id="open-popup-btn">
                        Learn more <i class="fa-solid fa-magnifying-glass ms-2"></i>
                    </button>
                </div>

            </div>
        </section>

        <!-- <div class="continue-wrapper">
            <a href="{{ url_for('learning.complete_subunit', unit_id=unit_id, subunit_index=4) }}" class="continue-button">
                <span>Continue Sailing</span>
            </a>
        </div> -->
        <div class="continue-wrapper">
            <a href="{{ url_for('main.home') }}" class="continue-button">
                <span>Continue Sailing</span>
            </a>
        </div>
    </main>
</div>

<div class="popup-overlay" id="learn-more-popup">
    <div class="popup-content">
        <div class="popup-header">
            <i class="fa-solid fa-magnifying-glass"></i>
            <h3 class="popup-title-text">Radio Message Structure & Function</h3>
            <div class="popup-header-controls">
                <button class="popup-translate-btn" id="popup-translate-btn">
                    <i class="fa-solid fa-language"></i>
                    <span>ID</span>
                </button>
                <button class="popup-close" id="close-popup-btn">&times;</button>
            </div>
        </div>
        <div class="popup-body">
            <div class="popup-section">
                <span class="popup-number">1</span>
                <div class="popup-text">
                    <h4 class="popup-section-title">Opening</h4>
                    <p class="popup-section-desc">Used by both caller and receiver to start the communication clearly.</p>
                    <ul class="popup-section-list">
                        <li><strong>Caller:</strong> <span class="popup-example">"This is [Ship Name], Call Sign..., MMSI..."</span></li>
                        <li><strong>Receiver:</strong> <span class="popup-example">"[Ship Name], this is [Your Ship]."</span></li>
                        <li><strong>Function:</strong> <span class="popup-function">Identify yourself and the ship you are contacting.</span></li>
                    </ul>
                </div>
            </div>
            <div class="popup-section">
                <span class="popup-number">2</span>
                <div class="popup-text">
                    <h4 class="popup-section-title">Middle</h4>
                    <p class="popup-section-desc">The core part of the message â€“ giving or confirming information.</p>
                    <ul class="popup-section-list">
                        <li><strong>Caller:</strong> <span class="popup-example">"Calling Motor Vessel [Name]."</span></li>
                        <li><strong>Receiver:</strong> <span class="popup-example">"Receiving you loud and clear."</span></li>
                        <li><strong>Function:</strong> <span class="popup-function">Deliver or acknowledge the main content.</span></li>
                    </ul>
                </div>
            </div>
            <div class="popup-section">
                <span class="popup-number">3</span>
                <div class="popup-text">
                    <h4 class="popup-section-title">Closing</h4>
                    <p class="popup-section-desc">Marks the end of your turn in radio communication.</p>
                    <ul class="popup-section-list">
                        <li><strong>Caller:</strong> <span class="popup-example">"Channel one-six. Over."</span></li>
                        <li><strong>Receiver:</strong> <span class="popup-example">"Over."</span></li>
                        <li><strong>Function:</strong> <span class="popup-function">End your turn and signal readiness for response.</span></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block page_js %}
<script>
    window.UNIT_CONTENT = {{ (content or {})|tojson|safe }};
    window.SECTION_CONTENT = {{ (section_content or {})|tojson|safe }};
    window.UNIT_ID = {{ unit_id | default(0) }};
</script>
<script src="{{ url_for('static', filename='js/noticing_intro.js') }}" defer></script>
{% endblock %}