{% extends 'base.html' %}
{% block title %}Unit {{ unit_id }} - Assessment: Open-ended Set{% endblock %}

{% block page_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/assessment_open_ended.css') }}">
{% endblock %}

{% block content %}
<main class="container my-4 open-ended-set" aria-live="polite">
  <div class="scene-panel shadow-lg" role="region" aria-label="Open-ended assessment set">
    <div class="top-bar d-flex justify-content-between align-items-center">
      <div class="progress-indicator">
        <span id="progress-counter">1 / 10</span>
      </div>
      <div class="lang-toggle">
        <button id="open-lang-toggle" class="toggle-pill" aria-pressed="false">EN</button>
      </div>
    </div>

    <div class="main-area">
      <div class="avatars">
        <img src="{{ url_for('static', filename='img/captain_ray.png') }}" alt="Captain Ray" class="avatar-left">
      </div>

      <section class="question-card" id="question-card" aria-live="polite">
        <h2 id="question-title" class="question-title">Assessment: Open-ended</h2>
        <p id="question-prompt" class="question-prompt">Prompt will appear here.</p>

        <div class="input-wrap">
          <textarea id="open-input" placeholder="Type your response here..." aria-label="Answer input"></textarea>
        </div>

        <div class="controls d-flex justify-content-center gap-2">
          <button id="submit-answer" class="btn btn-primary">Submit Answer</button>
          <button id="play-example" class="btn btn-audio" title="Play example"><i class="fas fa-volume-up"></i> Example</button>
          <button id="next-question" class="btn btn-next" disabled aria-disabled="true">Next</button>
        </div>

        <div id="answer-feedback" class="feedback-bubble visually-hidden" role="status" aria-live="polite">
          <img src="{{ url_for('static', filename='img/captain_ray_small.png') }}" alt="" class="fb-avatar">
          <div id="fb-text">Feedback text</div>
        </div>
      </section>
    </div>

    <div class="footer-cta text-center">
      <button id="finish-assessment" class="btn btn-finish d-none" disabled aria-disabled="true">Finish Assessment</button>
    </div>
  </div>

  <!-- example audio element -->
  <audio id="example-audio" preload="auto"></audio>
</main>
{% endblock %}

{% block page_js %}
<script> window.SECTION_CONTENT = {{ section_content|tojson|safe }}; window.UNIT_ID = {{ unit_id }}; </script>
<script src="{{ url_for('static', filename='js/assessment_open_ended.js') }}"></script>
{% endblock %}
